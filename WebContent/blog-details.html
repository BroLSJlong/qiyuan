<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title></title>
    <link href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,600,600i,700,700i,800,800i%7CQuicksand:300,400,500,600,700%7CRoboto:400,400i,500,500i,700,700i,900,900i&display=swap" rel="stylesheet">
    <!-- fontawesome css link -->
    <link rel="stylesheet" href="assets/css/fontawesome-all.min.css">
    <!-- flaticon css -->
    <link rel="stylesheet" href="assets/font/flaticon.css">
    <!-- magnific popup -->
    <link rel="stylesheet" href="assets/css/magnific-popup.css">
    <!-- nice-select css -->
    <link rel="stylesheet" href="assets/css/nice-select.css">
    <!-- bootstrap css link -->
    <link rel="stylesheet" href="assets/css/bootstrap.min.css">
    <!-- swipper css link -->
    <link rel="stylesheet" href="assets/css/swiper.min.css">
    <!-- favicon -->
    <link rel="shortcut icon" href="assets/images/fav.png" type="image/x-icon">
    <!-- animate.css -->
    <link rel="stylesheet" href="assets/css/animate.css">
    <!-- main style css link -->
    <link rel="stylesheet" href="assets/css/style.css">
</head>
<body>

    <!--~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
        Start Preloader
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~--> 
    <div class="preloader">
        <div class="preloader-inner">
            <div class="preloader-icon">
                <span></span>
                <span></span>
            </div><!-- /preloader-icon -->
        </div><!-- /preloader-inner -->
    </div><!-- /preloader -->

    <iframe src="header.html" width="100%" height="580px" frameborder="no" border="0" marginwidth="0" ></iframe>

    <a href="#" class="scrollToTop"><i class="fas fa-heart"></i></a>

    <!-- breadcrumb-section start -->
    <div class="breadcrumb-area">
        <div class="container">
            <nav aria-label="breadcrumb">
                <ol class="breadcrumb">
                <li class="breadcrumb-item"><a href="index.html"><i class="flaticon-house"></i>Home</a></li>
                <li class="breadcrumb-item"><a href="blog-1.html">Blog Post</a></li>
                <li class="breadcrumb-item active" aria-current="page">Blog Single</li>
                </ol>
            </nav>
        </div>
    </div>
    <!-- breadcrumb-section end -->

	<!-- 动态部分++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++=+++++++++++++++++++++ -->
    <!-- blog-section start -->
    <section class="blog-details-section ptb-120">
        <div class="container">
            <div class="row justify-content-center ml-b-30">
                <div class="col-lg-8 mrb-30">
                    <div class="blog-item mrb-60 wow fade-in-bottom" data-wow-duration="1s" data-wow-delay="0.5s">
                        <div class="blog-thumb">
                            <img id="img1" src="assets/images/blog/blog-20.png" alt="blog">
                        </div>
                        <div class="blog-content blog-content-two">
                            <h3 class="title wow fade-in-up" data-wow-duration="1s" data-wow-delay="0.5s"><span id="content1">他说：“伊普苏姆是一位音乐家，而音乐节是托托·拉克斯的节日。”</span></h3>
                           <!-- <ul class="blog-content-list">
                                <li><i class="far fa-heart"></i><span id="thumb1">03</span></li>
                                <li><i class="far fa-comment-alt"></i><span>评论（3）</span></li>
								<li><span id="time1">时间：</span></li>
                            </ul> -->
                            <!-- <p class="wow fade-in-up" data-wow-duration="1s" data-wow-delay="0.5s">el adipiscing maecenas est, velit urna a. Lorem vivammagna sem sodales mattis, libero lorem eligendi. Mauris wisi, phasellus etiam neque mattviverra mi eget justo, molestiae nec accumsan enim aliquam volutpat a, a nec vitae nulla facilisi enim malesuada. Enim egestas. Non sed, imperdiet vehicula neque convallis eratpedesed proin vitae sed vitae quam maecenas. Aliquet pede in dapibus neque in lorem, ut mauris ipsum, sem eu donec curabitur maecenas interdum, tempus sagittis orci id nec  eleifend phasellus et sapien. Nonummy duis malesuada, nascetur pellentesque purus, ut nibh ipsum suspendisse integer scelerisque laoreet wisi sed fringilla curae ligula sit. Tincidunt id donec adipiscing enim ut, cursus tortor maecenas risus in, est felis sit, vitae vehicula sapien repellat posuere.</p>
  -->                           <blockquote>
                                <!-- <p class="quote-content wow fade-in-up" data-wow-duration="1s" data-wow-delay="0.5s">Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Quis ipsum suspendisse ultricegrida. Risus commodo viverra maecenas accumsan lacus vel facilisis.  </p>
    -->                         </blockquote>
							
							<!-- 图片所在位置 start -->
                            <div class="blog-details-thumb-area">
                                <div class="row justify-content-center no-gutter ml-b-30" id="showImgs">
                                </div>
                            </div>
							<!-- 图片所在位置 end -->
							
                           <!--  <p class="wow fade-in-bottom" data-wow-duration="1s" data-wow-delay="0.5s">Nceptos rutrum erat, elementum bibendum nullam mi, odio malesuada blandit lectus sed ligula elementum, elit convallis at non. Est suspendisse vel dolor consectetuer turpis. In nulla nulla ac elit, purus wisi. Dui tortor ut, condimentum est mauris sed non aliquam, pellentesque anim massa adipiscing, consectetuer maecenas suscipit sed ligula curabitur, nec lacinia felis cubilia interdum eu. Magna cum. Venenatis sed lobortis urna, in amet quo sapien ut nec, nunc mauris aenean at mattis vestibulum vel, sed nunc per lectus. Justo eros elit. A pellentesque.</p>
        -->                     <div class="blog-details-tag-area d-flex flex-wrap justify-content-between ml-b-30">
								<ul class="blog-content-list">
									 <li><i class="fas fa-heart color-red"  onclick="addheart()" style="cursor:pointer"></i><span id="thumb1" >03</span></li> 
									<li><span id="time1">时间：</span></li>
									<li><span id="dynamicId1" style="display: none;"></span></li>
								 </ul>
								<ul class="tag-list mrb-30">
                                    <li><a href="#0">约会</a></li>
                                    <li><a href="#0">爱情故事</a></li>
                                    <li><a href="#0">私人活动</a></li>
                                </ul>
                            </div>
                        </div>
                    </div>
                    
					<!-- 评论部分start -->
                    <div class="comments-section">
                        <ul class="comment-wrapper">
                            <li>
								<!-- 一部分 -->
                                <div class="comment-item" id="comment-item">
                                    <div class="comment-content">
                                        <h3 class="title" data-wow-duration="1s" data-wow-delay="0.5s"><a href="#">评论</a></h3>
                                    </div>
                                </div>
							</li>
                        </ul>
                    </div>
					<!-- 评论部分end -->
					<div id="playN">
						<input type="text" name="" id="message" value="" />
						<input type="button" name="" id="fabiao" onclick="fabiao()" value="发表" />
					</div>
					
                </div>
                <div class="col-lg-4 col-sm-8">
                    <div class="sidebar">
                        <div class="widget-box mrb-60">
                            <div class="search-option">
                                <input type="text" name="search" placeholder="Search in here">
                            </div>
                            <button class="search-submit" type="submit">
                                <i class="flaticon-magnifying-glass-1"></i>
                            </button>
                        </div>
                        
						<!-- 预览动态start -->
                        <div class="widget-box mrb-60">
                            <span class="caption"><i class="far fa-file"></i>动态预览</span>
                            <div class="popular-item-area" id="motionPreview">
                            <!-- 存放动态 -->
                            </div>
                        </div>
						<!-- 预览动态end -->
						
						
                        <div class="widget-box mrb-60">
                            <div class="category-box">
                                <span class="caption"><i class="fas fa-stopwatch"></i></i>achived</span>
                                <ul class="category-content">
                                    <li><a href="#">january</a><span class="count">2018</span></li>
                                    <li><a href="#">march</a><span class="count">2018</span></li>
                                    <li><a href="#">jun</a><span class="count">2018</span></li>
                                    <li><a href="#">february</a><span class="count">2019</span></li>
                                </ul>
                            </div>
                        </div>
                        <div class="widget-box mrb-60">
                            <span class="caption"><i class="fas fa-tag"></i>tag</span>
                            <div class="tag-item-wrapper">
                                <a href="#" class="tag-item active">survey</a>
                                <a href="#" class="tag-item">love story</a>
                                <a href="#" class="tag-item">event</a>
                                <a href="#" class="tag-item">research</a>
                                <a href="#" class="tag-item">Customer support</a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>
    <!-- blog-section start -->

	<!-- footer -->
	<iframe src="footer.html" align="center"  width="100%"  frameborder="no" border="0" marginwidth="0" marginheight="0" scrolling="no"></iframe>


<!-- jquery -->
<script src="assets/js/jquery-3.3.1.min.js"></script>
<!-- migarate-jquery -->
<script src="assets/js/jquery-migrate-3.0.0.js"></script>
<!-- bootstrap js -->
<script src="assets/js/bootstrap.min.js"></script>
<!-- magnific-popup js -->
<script src="assets/js/jquery.magnific-popup.js"></script>
<!-- isotope -->
<script src="assets/js/isotope.pkgd.min.js"></script>
<!-- nice-select js-->
<script src="assets/js/jquery.nice-select.js"></script>
<!-- swipper js -->
<script src="assets/js/swiper.min.js"></script>
<!-- waypoints js link -->
<script src="assets/js/jquery.waypoints.min.js"></script>
<!-- counterup js -->
<script src="assets/js/jquery.counterup.min.js"></script>
<!-- wow js file -->
<script src="assets/js/wow.min.js"></script>
<!-- main -->
<script src="assets/js/main.js"></script>

</body>
	<script type="text/javascript">
		
	
	
	var dynam = oneValues();
	
	/**获取动态图片*/
	function showimg(dynam){
		$.post("/qiyuan/DynamicDetailController/select.do",{dynamicId:dynam},function(imgIds){
			for(var i=0;i<imgIds.length;i++){
				src = "/qiyuan/imgs/"+imgIds[i].imgId; 
				if(i==0){
					$("#img1").attr("src",src);
					continue;
				}
				node =  '<div class="col-lg-6 col-md-6 mrb-30 wow fade-in-bottom" data-wow-duration="1s" data-wow-delay="0.5s">'+
							'<div class="blog-details-thumb">'+
								'<img id="img2" src="'+src+'" alt="image">'+
							'</div>'+
							'<div class="blog-details-thumb-details">'+
								'<p></p>'+
							'</div>'+
						'</div>';
				$("#showImgs").append(node);
			}
			
		})
	}
		user = sessionStorage.getItem("user");
		$(function(){
			showimg(dynam);
			if(null != user && "" != user){
				user = JSON.parse(user);
				$.post("/qiyuan/DynamicController/selectOne.do",{dynamicId:dynam},function(dy){
					
					sessionStorage.setItem("dynamic",JSON.stringify(dynamic));
					for(i = 0; i < dy.length; i++){
						var dynamic  = dy[i];
						var thumbb = dynamic.thumb;
						$("#content1").html(dynamic.content);
						if(thumbb != null && thumbb != ""){
							$("#thumb1").html(dynamic.thumb);
						}else{
							$("#thumb1").html("0");
						}
						$("#time1").html(dynamic.time);
						$("#dynamicId1").html(dynamic.dynamicId);
							console.log(dynamic);
					}
					
					/* 评论 */
					$.post("/qiyuan/DynamicTalkController/selectTalk.do", {"dynamicId":dynamic.dynamicId} ,function(dyna){
								ucount = 0;
								for(j = 0 ; j < dyna.length ; j++){
									var dynamicTalkj = dyna[j];
									$.post("/qiyuan/UserController/selectUser.do",{idCard:dynamicTalkj.idCard},function(fuser){
										$("#comment-item").append($("<li>")
												.append($("<div class='comment-item' >")
													.append($("<div class='comment-thumb'>")
														.append($("<a href='#'>")
																.append($("<img src='/qiyuan/imgs/"+user.imgId+"' alt='blog'>"))
														)	
													)
													.append($("<div class='comment-content'>")
														.append($("<h5 class='sub-title wow fade-in-up' data-wow-duration='1s' data-wow-delay='0.5s'>").html(fuser[0].userName)
															.append($("<a href='#'>"))	
														)
														.append($("<span class='wow fade-in-up' data-wow-duration='1s' data-wow-delay='0.5s'>").html(dyna[ucount].talkTime))
														.append($(" <p class='wow fade-in-bottom' data-wow-duration='1s' data-wow-delay='0.5s'>").html(dyna[ucount].talkContent))
													)	
												)	
									)
									.append($("<br>"))
									ucount++;
									})
							}
								
					/* alert("第一部分运行完毕"); */
					}) 
				});
				
				/* 右边的动态预览 */
				$.post("/qiyuan/DynamicController/select.do",{idCard:user.idCard},function(dynamics){
						if(null != dynamics && "" != dynamics ){
							for( k=0 ; k < dynamics.length ;k++){
								var dynamics = dynamics[k];
								$("#motionPreview").append($("<div class='single-popular-item d-flex flex-wrap''>")
										.append($("<div class='popular-item-thumb'>")
												.append($("<img src='/qiyuan/imgs/"+user.imgId+"' alt='blog-image'>"))
										)
										.append($("<div class='popular-item-content'>")
												.append($(" <h3 class='title'>")
													.append($("<a href='blog-details.html' id= 'talkContents'>").html(dynamics.content))	
												)
												.append($("<span class='blog-user'>").html(dynamics.time))
												.append($("<span class='blog-user'>").html('点赞:'+dynamics.thumb+'人'))
										)
								)
								/* alert(dynamics.dynamicId); */
							/* 查询动态图片表 */
						$.post("/qiyuan/DynamicDetailController/select.do" , {"dynamicId":dynamics.dynamicId},function(dynamicDetail){
							/* alert("动态图片运行完成"); */
							
						})
							}
						}
					})
			}
		})
		
		/* 发表评论 */
		function fabiao(){
			/* alert(dynam);
			alert(user.idCard); */
			talk = $("#message").val();
			if(null != talk && "" != talk){
			$.post("/qiyuan/DynamicTalkController/add.do",{dynamicId:dynam,idCard:user.idCard ,talkContent:talk},function(){
				$("#comment-item").append($("<li>")
						.append($("<div class='comment-item' >")
								.append($("<div class='comment-thumb'>")
										.append($("<a href='#'>")
												.append($("<img src='/qiyuan/imgs/"+user.imgId+"' alt='blog'>"))
										)	
									)
									.append($("<div class='popular-item-content'>")
												.append($(" <h3 class='title'>")
													.append($("<a href='blog-details.html' id= 'talkContents'>").html(talk))	
												)
										)
								)
				)
			})
			}
		}
		
		 		/* 点赞 */
		 		function addheart(id){
		 		$.post("/qiyuan/DynamicController/selectTime.do",{"idCard":user.idCard},function(nDynamic){
		 			sessionStorage.setItem("nDynamic",JSON.stringify(nDynamic));
		 			for(h = 0; h < nDynamic.length; h++){
		 				var nDynamic = nDynamic[h];
		 				var dyId = nDynamic.dynamicId;
		 				var heart1 = parseInt($("#thumb1").html())+1;
		 				var heart2 = parseInt($("#thumb1").html())-1;
		 				/* （这条动态的Id：boolean nDynamicId）true代表点赞过，false代表没点赞过  存放到cookie*/
		 				 if(getCookie(dyId) == null || getCookie(dyId) == "false"){
		 					   setCookie(dyId,"true");      
		 					   // setCookie(id,"http://act.13322.com");   setCookie(id,"http://act.13322.com/euro/index.html"); 
		 					   $("#thumb1").html(heart1);
		 						loves = parseInt($("#thumb1").html());
		 				   }else{
		 					//if(getCookie(id)=="http://act.13322.com" ||  getCookie(id)=="http://act.13322.com/euro/index.html")
		 						$("#thumb1").html(heart2);
		 						setCookie(dyId,"false");  
		 					}
		 				updateLove(dyId);
		 			}
		 		}) 
		 } 
		
		function updateLove(id){
			/* 获取改变后的点赞数量 */
			var love = parseInt($("#thumb1").html());
			$.post("/qiyuan/DynamicController/updateDynamic.do" , {"thumb":love , "dynamicId":id} , function(){
			})
		}
		
		/* 回复 */
		function huifu(huiDynamicId){
			window.location.href="huifu.html?valus="+huiDynamicId;
		}
		
		//设置cookie
		function setCookie(key, value) {
				document.cookie = key + "=" + escape(value);
		}
		
		//获取cookie的值
		function getCookie(key) {
			if (document.cookie.length) {
				var cookies = ' ' + document.cookie;
				var start = cookies.indexOf(' ' + key + '=');
				if (start == -1) { return null; }
				var end = cookies.indexOf(";", start);
				if (end == -1) { end = cookies.length; }
				end -= start;
				var cookie = cookies.substr(start,end);
				return unescape(cookie.substr(cookie.indexOf('=') + 1, cookie.length - cookie.indexOf('=') + 1));
			}
			else { return null; }
		}
		
		//清除cookie
		function delCookie(name){
            var date = new Date(); 
            date.setTime(date.getTime() - 10000); //作用的时间改为过去的时间，使得cookie过期
            document.cookie = name + "=a; expires=" + date.toGMTString(); 
        } 
		
		//接收一个值
		function oneValues(){
		var result;
		var url=window.location.search; //获取url中"?"符后的字串  
		if(url.indexOf("?")!=-1){
		result = url.substr(url.indexOf("=")+1);
		}
		return result;
		}
	</script>
</html>
